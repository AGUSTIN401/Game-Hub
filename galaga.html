<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Galaga</title>
<style>
  body { margin: 0; background: black; overflow: hidden;}
  canvas { display: block; margin: auto; background: #000;}
</style>
</head>
<body>
<canvas id="game"></canvas>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = 600;
canvas.height = 400;

const player = {
  x: canvas.width/2 - 20,
  y: canvas.height - 50,
  width: 40,
  height: 20,
  speed: 6,
  movingLeft: false,
  movingRight: false,
  bullets: []
};

const enemies = [];
const enemyRows = 4;
const enemyCols = 7;
const enemyWidth = 30;
const enemyHeight = 20;
const enemyPadding = 15;

for(let r=0; r<enemyRows; r++){
  for(let c=0; c<enemyCols; c++){
    enemies.push({
      x: 50 + c*(enemyWidth + enemyPadding),
      y: 50 + r*(enemyHeight + enemyPadding),
      width: enemyWidth,
      height: enemyHeight,
      alive: true,
      shootCooldown: Math.floor(Math.random()*200) + 100
    });
  }
}

function drawPlayer(){
  ctx.fillStyle = 'cyan';
  ctx.fillRect(player.x, player.y, player.width, player.height);
}

function drawEnemies(){
  ctx.fillStyle = 'orange';
  enemies.forEach(enemy => {
    if(enemy.alive){
      ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
    }
  });
}

function drawBullets(){
  ctx.fillStyle = 'yellow';
  player.bullets.forEach(bullet => {
    ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
  });
  enemyBullets.forEach(bullet => {
    ctx.fillStyle = 'red';
    ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
  });
}

function update(){
  if(gameOver) return;

  // Player movement
  if(player.movingLeft && player.x > 0) player.x -= player.speed;
  if(player.movingRight && player.x + player.width < canvas.width) player.x += player.speed;

  // Player bullets move
  player.bullets.forEach((bullet, i) => {
    bullet.y -= bullet.speed;
    if(bullet.y + bullet.height < 0) player.bullets.splice(i,1);

    enemies.forEach(enemy => {
      if(enemy.alive &&
         bullet.x < enemy.x + enemy.width &&
         bullet.x + bullet.width > enemy.x &&
         bullet.y < enemy.y + enemy.height &&
         bullet.y + bullet.height > enemy.y){
           enemy.alive = false;
           player.bullets.splice(i,1);
      }
    });
  });

  // Enemy bullets move
  enemyBullets.forEach((bullet,i) => {
    bullet.y += bullet.speed;
    if(bullet.y > canvas.height) enemyBullets.splice(i,1);

    // Check collision with player
    if(bullet.x < player.x + player.width &&
       bullet.x + bullet.width > player.x &&
       bullet.y < player.y + player.height &&
       bullet.y + bullet.height > player.y){
         gameOver = true;
         alert('Â¡Game Over! Fuiste alcanzado.');
         location.reload();
    }
  });

  // Enemy shooting cooldown & shooting
  enemies.forEach(enemy => {
    if(enemy.alive){
      enemy.shootCooldown--;
      if(enemy.shootCooldown <= 0){
        enemyBullets.push({
          x: enemy.x + enemy.width/2 - 2,
          y: enemy.y + enemy.height,
          width: 4,
          height: 10,
          speed: 4
        });
        enemy.shootCooldown = Math.floor(Math.random()*300) + 100;
      }
    }
  });

  // Move enemies side to side
  let shouldDrop = false;
  enemies.forEach(enemy => {
    enemy.x += enemyDirection * enemySpeed;
    if(enemy.x + enemy.width > canvas.width || enemy.x < 0){
      shouldDrop = true;
    }
  });

  if(shouldDrop){
    enemyDirection *= -1;
    enemies.forEach(enemy => enemy.y += enemyDrop);
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawPlayer();
  drawEnemies();
  drawBullets();
}

let enemyDirection = 1;
let enemySpeed = 1;
let enemyDrop = 10;
let enemyBullets = [];
let gameOver = false;

window.addEventListener('keydown', e => {
  if(e.code === 'ArrowLeft') player.movingLeft = true;
  if(e.code === 'ArrowRight') player.movingRight = true;
  if(e.code === 'Space'){
    player.bullets.push({
      x: player.x + player.width/2 - 2,
      y: player.y,
      width: 4,
      height: 10,
      speed: 7
    });
  }
});

window.addEventListener('keyup', e => {
  if(e.code === 'ArrowLeft') player.movingLeft = false;
  if(e.code === 'ArrowRight') player.movingRight = false;
});

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
